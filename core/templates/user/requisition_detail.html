{% extends "base.html" %}
{% load static %}

{% block title %}{{ requisition.name }}{% endblock %}

{% block content %}

<h2 class="text-center mb-2 page-title">
    {{ requisition.name }}
</h2>

<!-- Botão no meio em baixo do título -->
<div class="text-center mb-3">
  <a href="{% url 'cart_view' %}" class="btn btn-white-outline fw-bold">
    Ver lista de envio
  </a>
</div>

<!-- Mensagens -->
{% if messages %}
  <div class="text-center mb-3">
    {% for msg in messages %}
      <div class="alert alert-{{ msg.tags }} d-inline-block px-4 py-2">
        {{ msg }}
      </div>
    {% endfor %}
  </div>
{% endif %}

<form action="{% url 'cart_add_bulk' requisition.id %}" method="POST">
    {% csrf_token %}

    <div class="products-wrap">
      <div class="row g-4 justify-content-center">

          {% for product in products %}
          <div class="col-6 col-md-3 col-lg-2 d-flex justify-content-center">

              <div class="product-card">
                  <img src="{{ product.image.url }}" class="product-img" alt="{{ product.name }}">

                  <div class="product-name">{{ product.name }}</div>

                  <div class="qty-box">
                      <button type="button" class="qty-btn" onclick="changeQty('{{ product.id }}', -1)">−</button>

                      <input id="qty_{{ product.id }}"
                             class="qty-input"
                             type="text"
                             value="0"
                             name="qty_{{ product.id }}"
                             readonly>

                      <button type="button" class="qty-btn" onclick="changeQty('{{ product.id }}', 1)">+</button>
                  </div>
              </div>

          </div>
          {% endfor %}

      </div>
    </div>

    <!-- 1 botão só na página -->
    <div class="text-center mt-4">
      <button type="submit" class="btn btn-white fw-bold px-4">
        Salvar na lista
      </button>
    </div>

</form>

<style>
.page-title{ color:#fff; font-weight:800; letter-spacing:.5px; }
.products-wrap{ max-width:1100px; margin:0 auto; }

.product-card{
  background:#fff;
  border-radius:18px;
  padding:18px;
  height:260px;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  box-shadow:0 4px 10px rgba(0,0,0,.12);
  text-align:center;
}

.product-img{ height:80px; object-fit:contain; margin:0 auto 10px; }
.product-name{
  font-weight:bold;
  font-size:.95rem;
  line-height:1.2;
  min-height:42px;
  max-height:42px;
  overflow:hidden;
  text-transform:uppercase;
}

.qty-box{ margin-top:auto; display:flex; justify-content:center; gap:8px; }
.qty-btn{
  width:32px;
  height:32px;
  background:#A61C1C;
  color:white;
  border:none;
  border-radius:6px;
  font-size:20px;
  font-weight:bold;
}
.qty-input{
  width:44px;
  height:32px;
  text-align:center;
  font-weight:bold;
  border:1px solid #ccc;
  border-radius:6px;
}

/* botões brancos */
.btn-white{
  background:#fff;
  color:#A61C1C;
  border:2px solid #fff;
  border-radius:10px;
}
.btn-white:hover{ background:transparent; color:#fff; }
.btn-white-outline{
  background:transparent;
  color:#fff;
  border:2px solid #fff;
  border-radius:10px;
}
.btn-white-outline:hover{ background:#fff; color:#A61C1C; }
</style>

<script>
function changeQty(id, amount) {
  let input = document.getElementById("qty_" + id);
  let value = parseInt(input.value) || 0;
  value += amount;
  if (value < 0) value = 0;
  input.value = value;
}

// ✅ se salvou com sucesso, zera tudo
window.addEventListener("load", function () {
  const ok = document.querySelectorAll(".alert-success");
  if (ok.length) {
    document.querySelectorAll("input[id^='qty_']").forEach(i => i.value = 0);
  }
});
</script>

{% endblock %}
