{% extends "base.html" %}
{% block title %}Lista de Envio{% endblock %}

{% block content %}
<h2 class="cart-title mb-3">Lista de Envio</h2>

{% if not items %}
  <div class="text-center text-white fw-bold mt-4">
    Nenhum item na lista ainda. Clique em <b>Adicionar mais itens</b>.
  </div>

  <div class="d-flex gap-2 justify-content-center mt-3">
    <a href="{% url 'requisition_list' %}" class="btn btn-white-outline fw-bold">Adicionar mais itens</a>
  </div>
{% else %}

<table class="table table-bordered table-striped shadow-sm bg-white">
  <thead class="table-danger">
    <tr class="fw-bold text-center">
      <th>Requisição</th>
      <th>Produto</th>
      <th>Quantidade</th>
      <th>Ações</th>
    </tr>
  </thead>

  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.product.requisition.name }}</td>
      <td class="fw-bold">{{ item.product.name }}</td>

      <td class="text-center">
        <form action="{% url 'cart_update' item.product.id %}" method="post" class="d-inline">
          {% csrf_token %}
          <div class="d-flex justify-content-center align-items-center gap-2">
            <button type="button" class="qty-btn" onclick="stepQty('{{ item.product.id }}', -1)">−</button>

            <input id="q_{{ item.product.id }}" type="number" name="quantity" min="0"
                   value="{{ item.quantity }}" class="qty-input" />

            <button type="button" class="qty-btn" onclick="stepQty('{{ item.product.id }}', 1)">+</button>

            <button class="btn btn-sm btn-white fw-bold" type="submit">Atualizar</button>
          </div>
        </form>
      </td>

      <td class="text-center">
        <form action="{% url 'cart_remove' item.product.id %}" method="post">
          {% csrf_token %}
          <button class="btn btn-sm btn-white-outline fw-bold" type="submit">Excluir</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="d-flex gap-2 justify-content-center mt-3">
  <a href="{% url 'requisition_list' %}" class="btn btn-white-outline fw-bold">Adicionar mais itens</a>

  <form action="{% url 'cart_submit' %}" method="post">
    {% csrf_token %}
    <button class="btn btn-white fw-bold">Enviar Pedido</button>
  </form>
</div>

{% endif %}

<style>
.cart-title{
  color:#fff;
  font-weight:800;
}

.btn-white{
  background:#fff;
  color:#A61C1C;
  border:2px solid #fff;
  border-radius:10px;
}
.btn-white:hover{ background:transparent; color:#fff; }

.btn-white-outline{
  background:transparent;
  color:#fff;
  border:2px solid #fff;
  border-radius:10px;
}
.btn-white-outline:hover{ background:#fff; color:#A61C1C; }

.qty-btn {
  width: 32px;
  height: 32px;
  background: #A61C1C;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 20px;
  font-weight: bold;
}
.qty-input {
  width: 70px;
  height: 32px;
  text-align: center;
  font-weight: bold;
  border: 1px solid #ccc;
  border-radius: 6px;
}
</style>

<script>
function stepQty(id, delta){
  const el = document.getElementById("q_" + id);
  let v = parseInt(el.value || "0", 10);
  v += delta;
  if (v < 0) v = 0;
  el.value = v;
}
</script>

{% endblock %}
